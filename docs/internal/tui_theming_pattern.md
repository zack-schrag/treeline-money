# TUI Theming Pattern

## Overview

All Treeline TUI applications use Textual's native theme system with a custom "treeline" theme and support for user-defined themes. This ensures a uniform look and feel across all interactive modes while allowing users to customize their experience.

## Architecture

```
textual.theme (Textual's Theme class)
    ↓
tui_theme.py (ThemedApp base class)
    ├─ get_treeline_theme() - Creates Treeline branded theme
    ├─ load_user_themes() - Auto-discovers user themes from ~/.treeline/themes/
    └─ ThemedApp.__init__() - Registers all themes
        ↓
analysis_textual.py (AnalysisApp extends ThemedApp)
tag_textual.py (TaggingApp extends ThemedApp)
queries_textual.py (QueriesBrowserApp extends ThemedApp)
charts_textual.py (ChartsBrowserApp extends ThemedApp)
```

## Implementation Pattern

### 1. Create TUI App Class

All TUI applications should inherit from `ThemedApp`:

```python
from treeline.tui_theme import ThemedApp

class MyTuiApp(ThemedApp):
    """My TUI application with consistent theming."""

    TITLE = "My Mode"

    def on_mount(self) -> None:
        """Initialize the app."""
        self.push_screen(MyMainScreen())
```

### 2. Use Textual's Theme System

The `ThemedApp` base class automatically:
- Registers the Treeline theme (set as default)
- Auto-discovers and registers user themes from `~/.treeline/themes/`
- Provides access to all Textual built-in themes
- Enables theme switching via command palette (Ctrl+\)

Textual generates CSS variables from the theme. Key variables available:

**Colors:**
- `$primary` - Primary brand color (sage green #44755a)
- `$secondary` - Secondary color
- `$accent` - Accent color
- `$success` - Success state
- `$error` - Error state
- `$warning` - Warning state

**Backgrounds:**
- `$background` - Main background
- `$surface` - Surface color
- `$panel` - Panel color

**Text:**
- `$text` - Primary text color
- And many more auto-generated by Textual

### 3. Example Screen with CSS

```python
from textual.screen import Screen
from textual.widgets import DataTable, Static, Container

class MyScreen(Screen):
    """Example screen using theme colors."""

    CSS = """
    MyScreen {
        background: $background;
    }

    #data_panel {
        border: solid $primary;
        background: $surface;
    }

    #error_message {
        color: $error;
        background: $panel;
    }

    .success {
        color: $success;
    }

    .muted {
        color: $text-muted;
    }
    """

    def compose(self):
        with Container(id="data_panel"):
            yield DataTable()
        yield Static("", id="error_message", classes="hidden")
```

## Available Themes

### Built-in (13+ themes)
- **treeline** (default) - Sage green nature-inspired theme
- textual-dark - Textual's default dark theme
- textual-light - Textual's light theme
- nord - Nordic-inspired color scheme
- dracula - Dark purple theme
- gruvbox - Retro groove colors
- catppuccin-mocha - Warm dark theme
- catppuccin-latte - Warm light theme
- tokyo-night - Tokyo night colors
- monokai - Classic monokai
- solarized-light - Popular light theme
- flexoki - Modern neutral theme
- textual-ansi - ANSI terminal colors

### User Themes
Users can create custom themes in `~/.treeline/themes/` as Python files. See [docs/external/guides/custom_themes.md](../external/guides/custom_themes.md) for details.

## Switching Themes

While in any TUI mode:
1. Press `Ctrl+\` (or `Ctrl+P`) to open command palette
2. Type "theme"
3. Select "Change theme"
4. Choose from available themes

## Benefits

1. **Consistency**: All TUI modes use Textual's theme system
2. **Flexibility**: 13+ themes built-in, unlimited user themes
3. **User Control**: Users can switch themes without code changes
4. **Standards-Based**: Using Textual's native system, not custom CSS
5. **Maintainability**: Textual handles theme logic, we just define colors
6. **Simplicity**: No need to generate custom CSS

## Color Palette Reference

Treeline default theme colors:

| Element | Hex | Usage |
|---------|-----|-------|
| Primary | #44755a | Headers, borders, highlights |
| Secondary | #7C9885 | Secondary highlights |
| Accent | #75B58F | Accent elements |
| Success | #4A7C59 | Success messages, positive actions |
| Error | #F87171 | Error messages, warnings |
| Warning | #FBBF24 | Warning messages |
| Background | #1a1a1a | Main background |
| Surface | #2a2a2a | Surface elements |
| Panel | #1f1f1f | Panel backgrounds |
| Foreground | #F9FAFB | Primary text |

## Creating Custom Themes

See [docs/external/guides/custom_themes.md](../external/guides/custom_themes.md) for user-facing guide.

For developers creating new built-in themes, add them to `tui_theme.py`:

```python
def get_my_new_theme() -> Theme:
    """Get a new built-in theme."""
    return Theme(
        name="my-theme",
        primary="#FF0000",
        dark=True,
    )

# Then register in ThemedApp.__init__:
self.register_theme(get_my_new_theme())
```

## Architecture Notes

### Two Theme Systems
- **TUI apps** (Textual): Use Textual's native theme system (`tui_theme.py`)
- **CLI commands** (Rich): Use legacy theme system (`theme.py`, `themes/default.json`)

This separation is intentional - CLI uses Rich for output which has different theming requirements.

### Key Files
- `src/treeline/tui_theme.py` - Theme system implementation
- `src/treeline/theme.py` - Legacy CLI theme (still used)
- `docs/external/guides/custom_themes.md` - User documentation
- `tests/unit/test_theme.py` - Theme system tests

## Migration Checklist

When creating a new TUI or migrating an existing one:

- [x] Import `ThemedApp` from `treeline.tui_theme`
- [x] Inherit from `ThemedApp` instead of `App`
- [x] Use Textual's theme CSS variables in Screen CSS
- [x] Remove hardcoded colors
- [x] Test theme switching via command palette
- [x] Verify app works with different built-in themes

## Future Enhancements

- [x] ~~Support for light theme~~ (12 built-in themes include light themes)
- [x] ~~User-configurable themes~~ (Implemented via ~/.treeline/themes/)
- [ ] Persist user's theme preference across sessions
- [ ] Theme preview command (show colors before applying)
- [ ] Per-mode theme customization (if needed)
